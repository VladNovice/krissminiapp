<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
  <title>KRISS — Noir Edition</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#000;
      --glass:rgba(255,255,255,0.03);
      --hairline:rgba(255,255,255,0.08);
      --accent:#fff;
      --sakura:#ffb7c5;
      --radius:18px;
    }
    *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{
      background:var(--bg);
      color:#fff;
      font-family:'Inter',system-ui,Segoe UI,Roboto,Arial;
      -webkit-font-smoothing:antialiased;
      overflow-x:hidden;
    }
    canvas{position:fixed;inset:0;width:100%;height:100%;z-index:0;pointer-events:none}

    .app{position:relative;z-index:1;padding:calc(env(safe-area-inset-top)+10px) 16px 140px;min-height:100vh}

    header{display:flex;flex-direction:column;gap:12px;padding:10px 0 20px 4px}
    .logo-img{height:42px;width:auto;object-fit:contain;opacity:.98}

    .search-container{display:none;width:100%}
    .search-input{width:100%;background:rgba(255,255,255,0.05);border:1px solid var(--hairline);border-radius:14px;padding:12px 14px;color:#fff;outline:none}

    .nav-container{display:flex;justify-content:center;margin-bottom:20px;position:sticky;top:calc(env(safe-area-inset-top) + 10px);z-index:100}
    .nav-capsule{display:flex;background:rgba(15,15,15,0.75);backdrop-filter:blur(20px);padding:4px;border-radius:22px;width:100%;box-shadow:inset 0 0 0 0.5px var(--hairline)}
    .nav-item{flex:1;text-align:center;padding:10px 0;border-radius:18px;font-size:13px;font-weight:300;color:rgba(255,255,255,0.4);cursor:pointer}
    .nav-item.active{background:rgba(255,255,255,0.08);color:#fff}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}

    .card{background:var(--glass);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border-radius:20px;overflow:hidden;position:relative;box-shadow:inset 0 0 0 0.5px var(--hairline)}
    .img-wrap{width:100%;aspect-ratio:0.75;overflow:hidden;background:#070707;position:relative;cursor:pointer}
    .card img{width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .45s ease;display:block}
    .card img.loaded{opacity:1}
    .fav-quick-btn{position:absolute;top:10px;right:10px;z-index:2;background:rgba(0,0,0,0.32);backdrop-filter:blur(6px);width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.06);cursor:pointer}
    .fav-quick-btn.active svg{fill:var(--sakura);stroke:var(--sakura)}

    .card-body{padding:12px;cursor:pointer}
    .card-cat{font-size:9px;font-weight:200;opacity:.45;text-transform:uppercase;letter-spacing:1.4px}
    .card-name{font-size:14px;font-weight:300;margin:6px 0;color:rgba(255,255,255,0.92)}
    .card-price{font-size:15px;font-weight:400}

    .dock-container{position:fixed;left:50%;transform:translateX(-50%);bottom:calc(env(safe-area-inset-bottom)+20px);z-index:1000}
    .dock{background:rgba(10,10,10,0.82);backdrop-filter:blur(30px) saturate(1.2);padding:12px 32px;border-radius:40px;display:flex;gap:36px;box-shadow:inset 0 0 0 0.5px var(--hairline),0 18px 36px rgba(0,0,0,0.45)}
    .dock-btn{display:flex;flex-direction:column;align-items:center;opacity:.35;transition:opacity .2s;cursor:pointer}
    .dock-btn.active{opacity:1}
    .dock-btn svg{width:22px;height:22px;margin-bottom:4px}
    .dock-btn span{font-size:9px;font-weight:300;letter-spacing:.5px}

    /* Минималистичный модал с галереей */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:2000;display:none;align-items:flex-start;justify-content:flex-start;padding-top:0}
    .modal-inner{
      width:100%;
      max-width:900px;
      margin:0 auto;
      border-radius:calc(var(--radius));
      overflow:hidden;
      background:linear-gradient(180deg, rgba(0,0,0,0.85), rgba(0,0,0,0.92));
      box-shadow:0 40px 80px rgba(0,0,0,0.6);
      transform:translateY(6vh);
      max-height:92vh;
      display:flex;
      flex-direction:column;
    }

    /* Галерея: изображение полно-ширины, без панели сверху */
    .gallery{
      position:relative;
      width:100%;
      flex:0 0 auto;
      background:#000;
      aspect-ratio: 3/4; /* на мобильных телефон лучше вертикальное */
      overflow:hidden;
      touch-action:pan-y;
    }
    .gallery-image{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform-origin:center;
      transition:transform .36s ease, opacity .25s ease;
      user-select:none;
      -webkit-user-drag:none;
    }

    /* стрелки поверх изображения */
    .g-arrow{
      position:absolute;top:50%;transform:translateY(-50%);
      width:44px;height:44px;border-radius:44px;display:flex;align-items:center;justify-content:center;
      background:rgba(0,0,0,0.35);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.04);cursor:pointer;
    }
    .g-arrow.left{left:10px}
    .g-arrow.right{right:10px}
    .g-arrow svg{width:20px;height:20px}

    /* кнопка закрыть - маленькая, полупрозрачная, сверху слева (перекрывает картинку) */
    .g-close{
      position:absolute;top:12px;left:12px;padding:8px 10px;border-radius:12px;background:rgba(0,0,0,0.28);border:1px solid rgba(255,255,255,0.04);cursor:pointer;
    }

    /* индикаторы и миниатюры */
    .gallery-bottom{
      padding:12px 14px;display:flex;flex-direction:column;gap:12px;background:linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.02));
    }
    .dots{display:flex;gap:8px;align-items:center;justify-content:center}
    .dot{width:8px;height:8px;border-radius:8px;background:rgba(255,255,255,0.12);cursor:pointer}
    .dot.active{background:var(--accent)}

    .thumbnails{
      display:flex;gap:8px;align-items:center;overflow-x:auto;padding-bottom:6px;
      -webkit-overflow-scrolling:touch;
    }
    .thumb{
      width:64px;height:64px;border-radius:10px;overflow:hidden;flex:0 0 auto;border:1px solid rgba(255,255,255,0.05);cursor:pointer;
      opacity:0.8;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .thumb.active{outline:2px solid rgba(255,255,255,0.08);opacity:1}

    /* Нижняя панель: название, цена, характеристики, кнопка */
    .details{
      padding:14px 16px 20px;display:flex;flex-direction:column;gap:12px;background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.04));
      overflow:auto;
      max-height:36vh;
    }
    .title-row{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .product-name{font-weight:300;font-size:18px}
    .product-price{font-weight:500;font-size:16px}
    .specs{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .spec-item{font-size:13px;opacity:0.85}
    .buy-row{display:flex;gap:12px;align-items:center}
    .size-wrap{display:flex;gap:10px}
    .size-btn{padding:10px 12px;border-radius:12px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);cursor:pointer;font-weight:400}
    .size-btn.active{background:#fff;color:#000;font-weight:600}
    .buy-btn{flex:1;padding:12px;border-radius:12px;background:#fff;color:#000;border:none;font-weight:600;cursor:pointer}

    @media (min-width:760px){
      .gallery{aspect-ratio:16/9}
      .modal-inner{display:flex;flex-direction:column}
      .details{max-height:260px}
    }

  </style>
</head>
<body>
  <canvas id="sakura" aria-hidden="true"></canvas>

  <div class="app" role="application" aria-label="KRISS магазин">
    <header id="app-header">
      <img src="kriss.png" srcset="kriss.png 1x, kriss@2x.png 2x" alt="KRISS" class="logo-img" decoding="async" loading="eager">
      <div class="search-container" id="search-box">
        <input id="search-input" class="search-input" type="text" placeholder="Поиск изделий..." oninput="handleSearch()" aria-label="Поиск изделий">
      </div>
    </header>

    <div class="nav-container" id="nav-container">
      <div class="nav-capsule" role="tablist" aria-label="Фильтр">
        <div class="nav-item active" role="tab" onclick="setFilter('все', this)">Все</div>
        <div class="nav-item" role="tab" onclick="setFilter('белье', this)">Белье</div>
        <div class="nav-item" role="tab" onclick="setFilter('пижамы', this)">Пижамы</div>
        <div class="nav-item" role="tab" onclick="setFilter('халаты', this)">Халаты</div>
      </div>
    </div>

    <div class="grid" id="catalog"></div>
  </div>

  <div class="dock-container">
    <div class="dock">
      <div class="dock-btn active" id="btn-shop" onclick="switchTab('shop')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" stroke-width="1.2"/></svg><span>МАГАЗИН</span>
      </div>
      <div class="dock-btn" id="btn-search" onclick="switchTab('search')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-width="1.2"/></svg><span>ПОИСК</span>
      </div>
      <div class="dock-btn" id="btn-fav" onclick="switchTab('fav')">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" stroke-width="1.2"/></svg><span>ЛЮБИМОЕ</span>
      </div>
    </div>
  </div>

  <!-- Модал с минималистичной галереей -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-inner" role="dialog" aria-modal="true" aria-label="Детали товара">
      <div class="gallery" id="gallery">
        <button class="g-close" id="g-close" aria-label="Закрыть" title="Назад">✕</button>
        <button class="g-arrow left" id="g-prev" aria-label="Предыдущее" title="Предыдущее">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M15 18l-6-6 6-6" stroke-width="1.6"/></svg>
        </button>
        <button class="g-arrow right" id="g-next" aria-label="Следующее" title="Следующее">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 6l6 6-6 6" stroke-width="1.6"/></svg>
        </button>
        <!-- картинка подставляется JS -->
        <img id="gallery-image" class="gallery-image" src="" alt="">
      </div>

      <div class="gallery-bottom">
        <div class="dots" id="dots"></div>
        <div class="thumbnails" id="thumbnails"></div>
      </div>

      <div class="details" id="details">
        <div class="title-row">
          <div class="product-name" id="product-name">Название</div>
          <div class="product-price" id="product-price">0 ₽</div>
        </div>

        <div class="product-desc" id="product-desc" style="opacity:0.9;font-weight:300;font-size:14px"></div>

        <div style="font-size:13px;color:rgba(255,255,255,0.65);margin-top:6px">Характеристики</div>
        <div class="specs" id="specs"></div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
          <div class="size-wrap" id="size-wrap">
            <div class="size-btn active">S</div>
            <div class="size-btn">M</div>
            <div class="size-btn">L</div>
          </div>
          <div style="min-width:120px">
            <button class="buy-btn" id="modal-buy">Добавить в корзину</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // безопасный доступ к WebApp
  const tg = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;
  if (tg && typeof tg.expand === 'function') { try { tg.expand(); tg.backgroundColor = '#000000'; } catch(e){} }

  // Продукты: теперь images (массив) и specs (ключ-значение)
  const PRODUCTS = [
    {
      id:1, cat:'белье', name:"Lace Noir Set", price:8500,
      images:["photo1-1.jpg","photo1-2.jpg","photo1-3.jpg"],
      desc:"Сексуальное черное кружево ручной работы. Идеальная посадка и французский шарм.",
      specs:[ ["Материал","Кружево+микрофибра"], ["Происхождение","Франция"], ["Уход","Деликатная стирка"], ["Цвет","Чёрный"] ]
    },
    {
      id:2, cat:'пижамы', name:"Silk Pearl Gown", price:12900,
      images:["photo2-1.jpg","photo2-2.jpg"],
      desc:"Натуральный шелк в жемчужном оттенке. Невесомая роскошь для ваших ночей.",
      specs:[ ["Материал","100% шёлк"], ["Длина","Макси"], ["Уход","Химчистка"], ["Цвет","Жемчужный"] ]
    },
    {
      id:3, cat:'белье', name:"Passion Body", price:7400,
      images:["photo3-1.jpg","photo3-2.jpg"],
      desc:"Кружевное боди, подчеркивающее каждую линию тела. Смелый выбор.",
      specs:[ ["Материал","Кружево/эластан"], ["Застёжка","На крючки"], ["Особенность","Эффект утяжки"], ["Цвет","Чёрный"] ]
    },
    {
      id:4, cat:'халаты', name:"Midnight Kimono", price:15600,
      images:["photo4-1.jpg","photo4-2.jpg","photo4-3.jpg"],
      desc:"Длинный халат из тяжелого шелка. Глубокий черный цвет и матовый блеск.",
      specs:[ ["Материал","Тяжёлый шёлк"], ["Длина","Длинный"], ["Подкладка","Нет"], ["Цвет","Чёрный"] ]
    }
  ];

  // favorites и состояние
  let favorites = JSON.parse(localStorage.getItem('kriss_favs') || '[]');
  let currentTab = 'shop';
  let currentFilter = 'все';

  // --- Рендер каталога ---
  function render(data){
    const catalog = document.getElementById('catalog');
    if(!data || data.length === 0){
      catalog.innerHTML = `<div class="empty-state" style="grid-column:1/3;opacity:.6">Ничего не найдено</div>`;
      return;
    }
    catalog.innerHTML = data.map(p => {
      const isFav = favorites.includes(p.id);
      const preview = p.images && p.images[0] ? p.images[0] : 'https://via.placeholder.com/400x600/111/111?text=KRISS';
      return `
        <div class="card" role="article" aria-label="${escapeHtml(p.name)}">
          <div class="fav-quick-btn ${isFav ? 'active' : ''}" onclick="toggleFav(event, ${p.id})" aria-pressed="${isFav}">
            <svg width="18" height="18" fill="${isFav ? 'var(--sakura)' : 'none'}" stroke="currentColor" viewBox="0 0 24 24"><path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" stroke-width="1.5"/></svg>
          </div>
          <div class="img-wrap" onclick="openProduct(${p.id})">
            <img data-src="${preview}" alt="${escapeHtml(p.name)}" loading="lazy" decoding="async" onload="this.classList.add('loaded')" src="https://via.placeholder.com/400x600/111/111?text=KRISS">
          </div>
          <div class="card-body" onclick="openProduct(${p.id})">
            <div class="card-cat">${p.cat}</div>
            <div class="card-name">${escapeHtml(p.name)}</div>
            <div class="card-price">${p.price.toLocaleString()} ₽</div>
          </div>
        </div>
      `;
    }).join('');
    // Подмена src на real images плавно
    document.querySelectorAll('.img-wrap img[data-src]').forEach(img=>{
      const real = img.getAttribute('data-src');
      const tmp = new Image();
      tmp.onload = ()=> img.src = real;
      tmp.src = real;
    });
  }

  // утилиты
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) }

  function switchTab(tab){
    currentTab = tab;
    document.querySelectorAll('.dock-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById('search-box').style.display = 'none';
    document.getElementById('nav-container').style.display = 'flex';

    if(tab === 'shop'){
      document.getElementById('btn-shop').classList.add('active');
      render(PRODUCTS.filter(p => currentFilter === 'все' || p.cat === currentFilter));
    } else if(tab === 'search'){
      document.getElementById('btn-search').classList.add('active');
      document.getElementById('search-box').style.display = 'block';
      document.getElementById('search-input').focus();
      handleSearch();
    } else if(tab === 'fav'){
      document.getElementById('btn-fav').classList.add('active');
      document.getElementById('nav-container').style.display = 'none';
      const favProducts = PRODUCTS.filter(p => favorites.includes(p.id));
      render(favProducts);
    }
    if(tg && tg.HapticFeedback) try { tg.HapticFeedback.impactOccurred('light'); } catch(e){}
  }

  function handleSearch(){
    const q = document.getElementById('search-input').value.toLowerCase();
    const filtered = PRODUCTS.filter(p => p.name.toLowerCase().includes(q) || p.cat.toLowerCase().includes(q));
    render(filtered);
  }

  function setFilter(cat, el){
    currentFilter = cat;
    document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
    el.classList.add('active');
    if(currentTab === 'shop') render(PRODUCTS.filter(p => cat === 'все' || p.cat === cat));
    if(tg && tg.HapticFeedback) try { tg.HapticFeedback.impactOccurred('light'); } catch(e){}
  }

  function toggleFav(event, id){
    event.stopPropagation();
    if(favorites.includes(id)) favorites = favorites.filter(x=>x!==id);
    else { favorites.push(id); if(tg && tg.HapticFeedback) try { tg.HapticFeedback.notificationOccurred('success'); } catch(e){} }
    localStorage.setItem('kriss_favs', JSON.stringify(favorites));
    if(currentTab === 'fav') switchTab('fav'); else render(PRODUCTS.filter(p => currentFilter === 'все' || p.cat === currentFilter));
    if(tg && tg.HapticFeedback) try { tg.HapticFeedback.impactOccurred('medium'); } catch(e){}
  }

  // --- Модал и галерея ---
  const modal = document.getElementById('modal');
  const modalInner = document.querySelector('.modal-inner');
  const galleryImage = document.getElementById('gallery-image');
  const gPrev = document.getElementById('g-prev');
  const gNext = document.getElementById('g-next');
  const gClose = document.getElementById('g-close');
  const dotsEl = document.getElementById('dots');
  const thumbsEl = document.getElementById('thumbnails');
  const productNameEl = document.getElementById('product-name');
  const productPriceEl = document.getElementById('product-price');
  const productDescEl = document.getElementById('product-desc');
  const specsEl = document.getElementById('specs');
  const modalBuy = document.getElementById('modal-buy');
  const sizeWrap = document.getElementById('size-wrap');

  let galleryImages = [];
  let currentImageIndex = 0;
  let activeProduct = null;

  function openProduct(id){
    const p = PRODUCTS.find(x=>x.id===id);
    if(!p) return;
    activeProduct = p;
    galleryImages = (p.images && p.images.length) ? p.images : ['https://via.placeholder.com/800x1200/111/111?text=KRISS'];
    currentImageIndex = 0;

    // Показать модал
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden','false');

    // Установить картинку (сначала placeholder, затем реальная)
    setGalleryImage(currentImageIndex);

    // Доты и миниатюры
    renderDots();
    renderThumbs();

    // Детали
    productNameEl.textContent = p.name;
    productPriceEl.textContent = p.price.toLocaleString() + ' ₽';
    productDescEl.textContent = p.desc;
    renderSpecs(p.specs);

    // сброс размеров/разметки
    document.querySelectorAll('.size-btn').forEach((b,i)=>{ b.classList.toggle('active', i===0); b.onclick = ()=> { document.querySelectorAll('.size-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); } });

    // buy
    modalBuy.onclick = ()=> {
      if(tg && typeof tg.showAlert === 'function') tg.showAlert('Товар добавлен в корзину');
      else alert('Товар добавлен в корзину');
      if(tg && tg.HapticFeedback) try { tg.HapticFeedback.notificationOccurred('success'); } catch(e){}
      closeModal();
    };

    if(tg && tg.HapticFeedback) try { tg.HapticFeedback.impactOccurred('medium'); } catch(e){}
    // focus for keyboard
    setTimeout(()=> modalInner.focus && modalInner.focus(), 80);
  }

  function closeModal(){
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden','true');
    activeProduct = null;
  }

  function setGalleryImage(index){
    currentImageIndex = Math.max(0, Math.min(index, galleryImages.length-1));
    const src = galleryImages[currentImageIndex];
    // плавная подмена: сначала сделать opacity 0, затем установить src и fade in
    galleryImage.style.opacity = 0;
    // tiny delay чтобы увидеть анимацию
    const tmp = new Image();
    tmp.onload = ()=> {
      galleryImage.src = src;
      galleryImage.alt = activeProduct ? activeProduct.name : '';
      galleryImage.style.opacity = 1;
      updateActiveThumbDot();
    };
    tmp.src = src;
    updateArrows();
  }

  function updateArrows(){
    gPrev.style.display = (currentImageIndex>0) ? 'flex' : 'none';
    gNext.style.display = (currentImageIndex<galleryImages.length-1) ? 'flex' : 'none';
  }

  function renderDots(){
    dotsEl.innerHTML = '';
    galleryImages.forEach((_,i)=>{
      const d = document.createElement('div');
      d.className = 'dot' + (i===currentImageIndex ? ' active' : '');
      d.onclick = ()=> setGalleryImage(i);
      dotsEl.appendChild(d);
    });
  }

  function renderThumbs(){
    thumbsEl.innerHTML = '';
    galleryImages.forEach((src,i)=>{
      const t = document.createElement('div');
      t.className = 'thumb' + (i===currentImageIndex ? ' active' : '');
      const im = document.createElement('img');
      im.loading = 'lazy';
      im.decoding = 'async';
      im.src = src;
      im.alt = (activeProduct ? activeProduct.name : '') + ' ' + (i+1);
      t.appendChild(im);
      t.onclick = ()=> setGalleryImage(i);
      thumbsEl.appendChild(t);
    });
  }

  function updateActiveThumbDot(){
    // dots
    Array.from(dotsEl.children).forEach((d,i)=> d.classList.toggle('active', i===currentImageIndex));
    // thumbs
    Array.from(thumbsEl.children).forEach((t,i)=> t.classList.toggle('active', i===currentImageIndex));
    // ensure thumbnail visible
    const activeThumb = thumbsEl.children[currentImageIndex];
    if(activeThumb) activeThumb.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'});
  }

  function renderSpecs(specs){
    specsEl.innerHTML = '';
    if(!specs || !specs.length) return;
    specs.forEach(([k,v])=>{
      const el = document.createElement('div');
      el.className = 'spec-item';
      el.innerHTML = `<strong style="opacity:.9">${escapeHtml(k)}</strong><div style="opacity:.7;font-weight:300">${escapeHtml(v)}</div>`;
      specsEl.appendChild(el);
    });
  }

  // кнопки
  gPrev.onclick = ()=> setGalleryImage(currentImageIndex-1);
  gNext.onclick = ()=> setGalleryImage(currentImageIndex+1);
  gClose.onclick = closeModal;

  // клавиши
  window.addEventListener('keydown', (e)=>{
    if(modal.style.display !== 'flex') return;
    if(e.key === 'ArrowLeft') setGalleryImage(currentImageIndex-1);
    if(e.key === 'ArrowRight') setGalleryImage(currentImageIndex+1);
    if(e.key === 'Escape') closeModal();
  });

  // свайп/drag support (pointer)
  (function addSwipe(){
    const gallery = document.getElementById('gallery');
    let startX = 0, startY = 0, isDown = false, lastX = 0;
    gallery.addEventListener('pointerdown', (e)=>{
      isDown = true; startX = e.clientX; startY = e.clientY; lastX = startX;
      gallery.setPointerCapture(e.pointerId);
    });
    gallery.addEventListener('pointermove', (e)=>{
      if(!isDown) return;
      lastX = e.clientX;
      const dx = lastX - startX;
      // едва заметное смещение изображения при перетаскивании
      galleryImage.style.transform = `translateX(${dx*0.3}px)`;
    });
    gallery.addEventListener('pointerup', (e)=>{
      if(!isDown) return;
      isDown = false;
      galleryImage.style.transform = '';
      const dx = e.clientX - startX;
      if(dx > 40) setGalleryImage(currentImageIndex-1);
      else if(dx < -40) setGalleryImage(currentImageIndex+1);
    });
    gallery.addEventListener('pointercancel', ()=> { isDown=false; galleryImage.style.transform=''; });
  })();

  // --- Инициализация ---
  render(PRODUCTS);

  // open first product on tap for demo (optional)
  // openProduct(PRODUCTS[0].id);

  // Sakura engine (упрощённо)
  const canvas = document.getElementById('sakura');
  const ctx = canvas.getContext && canvas.getContext('2d');
  let petals = [];
  function resize(){ if(!canvas) return; canvas.width = innerWidth; canvas.height = innerHeight; }
  window.addEventListener('resize', resize);
  resize();
  class Petal { constructor(){ this.init() } init(){ this.x=Math.random()*canvas.width; this.y=Math.random()*canvas.height - canvas.height; this.size=Math.random()*2.5+1; this.speed=Math.random()*0.2+0.1; this.angle=Math.random()*Math.PI*2; this.spin=Math.random()*0.01-0.005; this.opacity=Math.random()*0.12+0.04 } update(){ this.y += this.speed; this.x += Math.sin(this.y/100)*0.15; this.angle += this.spin; if(this.y>canvas.height) this.init() } draw(){ if(!ctx) return; ctx.save(); ctx.translate(this.x,this.y); ctx.rotate(this.angle); ctx.beginPath(); ctx.ellipse(0,0,this.size,this.size/2,0,0,Math.PI*2); ctx.fillStyle = `rgba(255,183,197,${this.opacity})`; ctx.fill(); ctx.restore() } }
  for(let i=0;i<22;i++) petals.push(new Petal());
  function animate(){ if(!ctx) return; ctx.clearRect(0,0,canvas.width,canvas.height); petals.forEach(p=>{p.update();p.draw()}); requestAnimationFrame(animate) }
  animate();

  // Закрытие при клике вне модального блока
  modal.addEventListener('click', (e)=>{
    if(e.target === modal) closeModal();
  });

  // небольшая помощь: если у тебя картинок нет, они покажутся placeholder'ом — просто положи нужные файлы рядом.
</script>
</body>
</html>
